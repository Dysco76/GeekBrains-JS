<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>

  <style>
    h3,
    p {
      margin: 10px 0;
    }

    .catalog {
      max-width: 1200px;
      display: grid;
      grid-template-columns: repeat(auto-fill, 270px);
      justify-content: start;
      gap: 10px;
    }

    .product {
      box-sizing: border-box;
      background-color: #eee;
      max-width: 270px;
      padding: 20px;
    }

    .product img {
      width: 100%;
    }

    .product input {
      width: 40px;
      margin-bottom: 10px;
    }

    .cart {
      border-top: 2px solid black;
      padding-top: 40px;
      margin: 100px 0;
      font-size: 24px;
    }

    .cart-item {
      background-color: #eee;
      border: 1px solid black;
      padding: 0 10px 10px;
    }
  </style>
</head>

<body>

  <div class="catalog">

  </div>
  <div class="cart">

  </div>



  <script>
    'use strict'

    const catalog = {
      catalogElement: document.querySelector('.catalog'),

      products: [
        {
          id: '111',
          title: 'Зайчик',
          price: 150,
          imgName: 'placeholder.jpg',
        },
        {
          id: '222',
          title: 'Пончик',
          price: 50,
          imgName: 'placeholder.jpg',
        },
        {
          id: '333',
          title: 'Макарончик',
          price: 400,
          imgName: 'placeholder.jpg',
        },
        {
          id: '444',
          title: 'Одеколончик',
          price: 1000,
          imgName: 'placeholder.jpg',
        },
      ],

      init() {
        this.renderCatalog();
        this.addButtonHandler();
      },

      createProductCard(product) {
        return `<div class="product">
                  <img src="${product.imgName}" alt="">
                  <h3>${product.title}</h3>
                  <p>${product.price}$</p>
                  <input type="number" name="quant" id="quant">
                  <label for="quant">Количество</label>
                  <button id="${product.id}">Добавить в корзину</button>
                </div>`
      },

      renderCatalog() {
        if (this.products.length) {
          this.products.forEach(product => this.catalogElement.insertAdjacentHTML('beforeend', this.createProductCard(product)));
        } else {
          this.catalogElement.insertAdjacentHTML('beforeend', '<h3>В каталоге пусто!</h3>')
        }
      },

      getProductQuant(clickedProduct) {
        const quantInput = clickedProduct.parentElement.querySelector('input');
        let quantity = quantInput.value;

        if (!quantity) {
          quantity = 1;
        }

        quantInput.value = '';
        return quantity
      },

      getClickedProduct(clickedProduct) {
        return this.products.find(product => product.id === clickedProduct.id);
      },

      addButtonHandler() {
        this.catalogElement.addEventListener('click', e => {
          const clicked = e.target;

          if (clicked.tagName !== 'BUTTON') return

          cart.addProduct(this.getClickedProduct(clicked), this.getProductQuant(clicked));
        })
      },
    }

    const cart = {
      cartElement: document.querySelector('.cart'),

      products: [
      ],

      init() {
        this.renderCart();
        this.removeProductHandler();
      },

      createCardItem(product) {
        return `<div class="cart-item">
                  <h3>${product.title}</h3>
                  <p>Цена: ${product.price}$</p>
                  <p>Количество ${product.quantity}</p>
                  <button id="${product.id}">Удалить товар</button>
                </div>`;
      },

      countGoods() {
        return this.products.reduce((totalGoods, product) => totalGoods += product.quantity, 0)
      },

      countPrice() {
        return this.products.reduce((totalPrice, product) => totalPrice += product.price * product.quantity, 0)
      },

      getCartTotal() { return `В корзине: ${cart.countGoods()} товаров на сумму ${cart.countPrice()} рублей` },

      addProduct(product, quantity) {
        const isProductInCart = this.findProductByID(product.id);

        if (isProductInCart) {
          isProductInCart.quantity += +quantity;
        } else {
          product.quantity = +quantity;
          this.products.push(product)
        }


        this.renderCart();
      },

      findProductByID(id) {
        return this.products.find(product => product.id === id);
      },

      removeProductHandler() {
        this.cartElement.addEventListener('click', e => {
          const clicked = e.target;

          if (clicked.tagName !== 'BUTTON') return;

          this.products.splice(this.products.indexOf(this.findProductByID(clicked.id)), 1);

          this.renderCart();
        })
      },

      renderCart() {
        if (!cart.countGoods() > 0) {
          this.cartElement.textContent = 'Корзина пуста!'
        } else {
          this.cartElement.textContent = '';
          this.cartElement.insertAdjacentHTML('beforeend', this.getCartTotal());
          this.products.forEach(product => this.cartElement.insertAdjacentHTML('beforeend', this.createCardItem(product)))
        }
      }
    }

    catalog.init();
    cart.init();
  </script>

</body>

</html>